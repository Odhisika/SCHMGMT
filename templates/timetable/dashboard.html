{% extends 'base.html' %}
{% load i18n %}
{% block title %}{{ title }} | {% trans 'Learning management system' %}{% endblock title %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{% trans 'Timetable' %}</li>
    </ol>
</nav>

<div class="title-1"><i class="fas fa-calendar-alt"></i> {% trans 'Timetable Dashboard' %}</div>
<br>

{% include 'snippets/messages.html' %}

{% if current_term %}
<div class="alert alert-info">
    <i class="fas fa-info-circle"></i> 
    {% trans 'Current Term' %}: <strong>{{ current_term }}</strong>
</div>
{% else %}
<div class="alert alert-warning">
    <i class="fas fa-exclamation-triangle"></i> 
    {% trans 'No active term found. Please set a current term first.' %}
</div>
{% endif %}

<div class="row mt-4">
    {% if request.user.is_superuser or request.user.is_school_admin %}
    <div class="col-md-4">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <i class="fas fa-cog"></i> {% trans 'Management' %}
            </div>
            <div class="card-body">
                <a href="{% url 'timetable:period_list' %}" class="btn btn-outline-primary btn-block mb-2 w-100">
                    <i class="fas fa-clock"></i> {% trans 'Manage Periods' %}
                </a>
                <a href="{% url 'timetable:timetable_generate' %}" class="btn btn-outline-success btn-block w-100">
                    <i class="fas fa-magic"></i> {% trans 'Auto-Generate Timetable' %}
                </a>
            </div>
        </div>
    </div>
    {% endif %}

    <div class="{% if request.user.is_superuser or request.user.is_school_admin %}col-md-8{% else %}col-md-12{% endif %}">
        <div class="card">
            <div class="card-header bg-success text-white">
                <i class="fas fa-table"></i> {% trans 'View Timetables' %}
            </div>
            <div class="card-body">
                {% if grouped_levels %}
                    {% for division_name, levels in grouped_levels %}
                    <h5 class="mt-3">{{ division_name }}</h5>
                    <div class="row mb-3">
                        {% for code, name in levels %}
                        <div class="col-md-4 mb-2">
                            <a href="{% url 'timetable:timetable_by_class' level=code %}" class="btn {% if division_name == 'Primary School' %}btn-outline-primary{% elif division_name == 'Junior High School' %}btn-outline-success{% else %}btn-outline-info{% endif %} w-100">
                                {{ name }}
                            </a>
                        </div>
                        {% endfor %}
                    </div>
                    {% endfor %}
                {% else %}
                    <div class="alert alert-info">
                        <i class="fas fa-info-circle"></i> {% trans 'No classes available for your account type.' %}
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</div>

{% endblock %}
