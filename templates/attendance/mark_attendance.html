{% extends 'base.html' %}
{% load i18n static custom_filters %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'css/clean-ui.css' %}">
{% endblock %}

{% block title %}{{ title }} - {{ level_name }} | {% trans 'Attendance' %}{% endblock %}

{% block content %}
<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'attendance:dashboard' %}">{% trans 'Attendance' %}</a></li>
        <li class="breadcrumb-item active">{{ level_name }}</li>
    </ol>
</nav>

<div class="title-1"><i class="fas fa-check-square"></i> {% trans 'Mark Attendance' %} - {{ level_name }}</div>
<br>

{% include 'snippets/messages.html' %}

<div class="card-clean">
    <div class="card-header-clean">
        <h3>{% trans 'Date' %}: {{ attendance_date }}</h3>
    </div>
    <div class="card-body-clean">
        <form method="post" class="form-clean">
            {% csrf_token %}
            
            <table class="table-clean">
                <thead>
                    <tr>
                        <th style="width: 50px;">#</th>
                        <th>{% trans 'Student Name' %}</th>
                        <th style="width: 200px;">{% trans 'Status' %}</th>
                        <th>{% trans 'Remarks' %}</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    {% with record=existing_attendance|default_if_none:None|get_item:student.id %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>{{ student.student.get_full_name }}</td>
                        <td>
                            <select name="status_{{ student.id }}" class="form-select" style="padding: 8px;">
                                <option value="Present" {% if record.status == 'Present' or not record %}selected{% endif %}>
                                    ✓ {% trans 'Present' %}
                                </option>
                                <option value="Absent" {% if record.status == 'Absent' %}selected{% endif %}>
                                    ✗ {% trans 'Absent' %}
                                </option>
                                <option value="Late" {% if record.status == 'Late' %}selected{% endif %}>
                                    ⧗ {% trans 'Late' %}
                                </option>
                                <option value="Excused" {% if record.status == 'Excused' %}selected{% endif %}>
                                    ☐ {% trans 'Excused' %}
                                </option>
                            </select>
                        </td>
                        <td>
                            <input type="text" name="remarks_{{ student.id }}" 
                                   value="{{ record.remarks|default:'' }}" 
                                   placeholder="{% trans 'Optional reason' %}"
                                   style="padding: 8px; border: 1px solid #dadce0; border-radius: 4px; width: 100%;">
                        </td>
                    </tr>
                    {% endwith %}
                    {% empty %}
                    <tr>
                        <td colspan="4" class="empty-state">
                            <p>{% trans 'No students in this class' %}</p>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <div style="margin-top: 24px; display: flex; gap: 12px;">
                <button type="submit" class="btn-primary-clean">
                    <i class="fas fa-save"></i> {% trans 'Save Attendance' %}
                </button>
                <a href="{% url 'attendance:dashboard' %}" class="btn-outline-clean">
                    {% trans 'Cancel' %}
                </a>
            </div>
        </form>
    </div>
</div>

{% endblock %}
