{% extends 'base.html' %}
{% load crispy_forms_tags %}
{% load i18n %}

{% block title %}{% trans 'Quiz Form' %} | {{ course }}{% endblock %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programs' %}">{% trans 'Programs' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'program_detail' course.program.id %}">{{ course.program }}</a></li>
        <li class="breadcrumb-item"><a href="{{ course.get_absolute_url }}">{{ course }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'quiz_index' course.slug %}">{% trans 'Quizzes' %}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{% trans 'Quiz Form' %}</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-0">{% trans 'Quiz Form For' %} <strong>{{ course|truncatechars:25 }}</strong></h2>
        <p class="text-muted small mb-0">{{ course.code }}</p>
    </div>
</div>

{% include 'snippets/messages.html' %}

<form action="" method="POST">{% csrf_token %}
    <!-- Hidden fields -->
    <div hidden>
        {{ form.course }}
        {{ form.questions }}
    </div>

    <div class="row g-4">

        <!-- LEFT: Quiz Details -->
        <div class="col-lg-6">
            <div class="card h-100 border-0 shadow-sm">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="mb-0"><i class="fas fa-edit me-2 text-primary"></i>{% trans 'Quiz Details' %}</h5>
                </div>
                <div class="card-body">
                    {{ form.category|as_crispy_field }}
                    {{ form.title|as_crispy_field }}
                    {{ form.pass_mark|as_crispy_field }}
                    {{ form.description|as_crispy_field }}
                </div>
            </div>
        </div>

        <!-- RIGHT: Settings -->
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="mb-0"><i class="fas fa-cog me-2 text-secondary"></i>{% trans 'Quiz Settings' %}</h5>
                </div>
                <div class="card-body">
                    {{ form.random_order|as_crispy_field }}
                    {{ form.answers_at_end|as_crispy_field }}
                    {{ form.exam_paper|as_crispy_field }}
                    {{ form.single_attempt|as_crispy_field }}
                    {{ form.max_attempts|as_crispy_field }}
                    {{ form.allow_review_after_submission|as_crispy_field }}
                </div>
            </div>

            <!-- Draft and publish status -->
            <div class="card border-0 shadow-sm mb-4">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="mb-0">
                        <i class="fas fa-eye-slash me-2 text-warning"></i>{% trans 'Visibility' %}
                    </h5>
                </div>
                <div class="card-body">
                    {{ form.draft|as_crispy_field }}
                    <div class="alert alert-info small py-2 mt-1">
                        <i class="fas fa-info-circle me-1"></i>
                        {% trans 'Draft quizzes are hidden from students. Set a "Publish At" date below to auto-publish on schedule.' %}
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- SCHEDULING AND TIMING ROW -->
    <div class="row g-4 mt-1">
        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="mb-0"><i class="fas fa-stopwatch me-2 text-danger"></i>{% trans 'Time Limit' %}</h5>
                </div>
                <div class="card-body">
                    {{ form.time_limit_minutes|as_crispy_field }}
                    <div class="alert alert-warning small py-2 mt-1">
                        <i class="fas fa-exclamation-triangle me-1"></i>
                        {% trans 'When the time runs out, the student\'s quiz is automatically submitted.' %}
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-6">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white border-bottom py-3">
                    <h5 class="mb-0"><i class="fas fa-calendar-alt me-2 text-success"></i>{% trans 'Availability Window' %}</h5>
                </div>
                <div class="card-body">
                    <div class="mb-3">
                        <label class="form-label fw-semibold">{% trans 'Publish At' %} <small class="text-muted fw-normal">({% trans 'optional' %})</small></label>
                        {{ form.available_from }}
                        {% if form.available_from.errors %}
                        <div class="text-danger small mt-1">{{ form.available_from.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans 'Quiz becomes visible to students at this time.' %}</small>
                    </div>
                    <div class="mb-3">
                        <label class="form-label fw-semibold">{% trans 'Close At' %} <small class="text-muted fw-normal">({% trans 'optional' %})</small></label>
                        {{ form.available_until }}
                        {% if form.available_until.errors %}
                        <div class="text-danger small mt-1">{{ form.available_until.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans 'After this time, students can no longer attempt the quiz (review only).' %}</small>
                    </div>
                    <div class="mb-1">
                        <label class="form-label fw-semibold">{% trans 'Show Correct Answers After' %} <small class="text-muted fw-normal">({% trans 'optional' %})</small></label>
                        {{ form.show_correct_answers_after }}
                        {% if form.show_correct_answers_after.errors %}
                        <div class="text-danger small mt-1">{{ form.show_correct_answers_after.errors }}</div>
                        {% endif %}
                        <small class="text-muted d-block mt-1">{% trans 'Correct answers will be revealed in review mode after this date.' %}</small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex gap-2 mt-4 mb-5">
        <button class="btn btn-primary px-5" type="submit">
            <i class="fas fa-save me-2"></i>{% trans 'Save & Continue' %}
        </button>
        <a href="{% url 'quiz_index' course.slug %}" class="btn btn-light px-4">{% trans 'Cancel' %}</a>
    </div>
</form>

{% endblock %}
