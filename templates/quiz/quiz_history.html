{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans 'My Quiz History' %} | {{ course }}{% endblock %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
        <li class="breadcrumb-item"><a href="{{ course.get_absolute_url }}">{{ course }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'quiz_index' course.slug %}">{% trans 'Quizzes' %}</a></li>
        <li class="breadcrumb-item active">{% trans 'My Attempts' %}</li>
    </ol>
</nav>

<h2 class="mb-1">{% trans 'My Quiz Attempts' %}</h2>
<p class="text-muted mb-4">{{ course }}</p>

{% include 'snippets/messages.html' %}

{% if sittings %}
<div class="card border-0 shadow-sm">
    <div class="table-responsive">
        <table class="table align-middle mb-0">
            <thead class="table-light">
                <tr>
                    <th>#</th>
                    <th>{% trans 'Quiz' %}</th>
                    <th>{% trans 'Category' %}</th>
                    <th>{% trans 'Score' %}</th>
                    <th>{% trans 'Result' %}</th>
                    <th>{% trans 'Date Completed' %}</th>
                    <th class="text-center">{% trans 'Review' %}</th>
                </tr>
            </thead>
            <tbody>
                {% for sitting in sittings %}
                <tr>
                    <td class="text-muted small">{{ forloop.counter }}</td>
                    <td>
                        <span class="fw-semibold">{{ sitting.quiz.title|title }}</span>
                    </td>
                    <td>
                        <span class="badge
                            {% if sitting.quiz.category == 'exam' %}bg-danger
                            {% elif sitting.quiz.category == 'assignment' %}bg-warning text-dark
                            {% else %}bg-info text-dark{% endif %} rounded-pill">
                            {{ sitting.quiz.category|title|default:'Quiz' }}
                        </span>
                    </td>
                    <td>
                        <span class="fw-semibold">{{ sitting.get_current_score }}/{{ sitting.get_max_score }}</span>
                        <small class="text-muted">({{ sitting.get_percent_correct }}%)</small>
                    </td>
                    <td>
                        {% if sitting.check_if_passed %}
                        <span class="badge bg-success"><i class="fas fa-check me-1"></i>{% trans 'Passed' %}</span>
                        {% else %}
                        <span class="badge bg-danger"><i class="fas fa-times me-1"></i>{% trans 'Failed' %}</span>
                        {% endif %}
                    </td>
                    <td class="text-muted small">
                        {% if sitting.end %}{{ sitting.end|date:"N j, Y g:i A" }}{% else %}â€”{% endif %}
                    </td>
                    <td class="text-center">
                        <a href="{% url 'quiz_review' pk=course.pk slug=sitting.quiz.slug %}"
                           class="btn btn-sm btn-outline-primary">
                            <i class="fas fa-eye me-1"></i>{% trans 'Review' %}
                        </a>
                    </td>
                </tr>
                {% endfor %}
            </tbody>
        </table>
    </div>
</div>
{% else %}
<div class="text-center py-5 text-muted">
    <i class="fa-regular fa-folder-open fa-3x mb-3 d-block"></i>
    <h5>{% trans 'No attempts yet.' %}</h5>
    <a href="{% url 'quiz_index' course.slug %}" class="btn btn-primary mt-2">{% trans 'Go to Quizzes' %}</a>
</div>
{% endif %}

{% endblock %}
