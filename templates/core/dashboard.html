{% extends 'base.html' %}
{% load i18n %}
{% block title %} {% trans 'Dashboard' %} | {% trans 'Learning management system' %} {% endblock title %}
{% load static %}

{% block header %}
{% endblock %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
      <li class="breadcrumb-item active" aria-current="page">{% trans 'Dashboard' %}</li>
    </ol>
</nav>

{% include 'snippets/messages.html' %}

<div class="d-flex justify-content-between align-items-center mb-4">
	<h1 class="title-1">{% trans 'Dashboard' %}</h1>
	<div class="dropdown">
		<button type="button" class="btn btn-light dropdown-toggle" data-bs-toggle="dropdown"
			aria-expanded="false">
			<i class="fas fa-cog"></i>
		</button>
		<div class="dropdown-menu">
			<h6 class="dropdown-header">{% trans 'Dashboard settings' %}</h6>
			<button class="dropdown-item active" type="button">{% trans 'Display grid' %}</button>
			<button class="dropdown-item" type="button">{% trans 'Display table' %}</button>
			<hr>
			<button class="dropdown-item" type="button">{% trans 'Manage dashboard' %}</button>
		</div>
	</div>
</div>

<div class="row users-count px-3">
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-users text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Students' %}
				<h2 class="text-dark">{{ student_count }}</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-chalkboard-teacher text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Teachers' %}
				<h2 class="text-dark">{{ lecturer_count }}</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-user-shield text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Staff' %}
				<h2 class="text-dark">{{ superuser_count }}</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-bus text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Bus Drivers' %}
				<h2 class="text-dark">0</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-utensils text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Canteen Staff' %}
				<h2 class="text-dark">0</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-shield-alt text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Security' %}
				<h2 class="text-dark">0</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-broom text-secondary"></i></h3>
			<div class="text-right pl-2">
				{% trans 'Cleaners' %}
				<h2 class="text-dark">0</h2>
			</div>
		</div>
	</div>
	<div class="col-6 col-md-3 mb-3 px-2">
		<div class="card-count p-3 bg-white shadow-sm border-0 rounded-3">
			<h3><i class="fas fa-users text-secondary"></i></h3>
			<div class="text-right">
				{% trans 'Others' %}
				<h2 class="text-dark">0</h2>
			</div>
		</div>
	</div>
</div>

<div class="row px-2">
	<div class="col-md-6 p-2">
		<div class="chart-wrap">
			<i class="fas fa-expand-alt"></i>
			<canvas id="traffic"></canvas>
		</div>
	</div>
	<div class="col-md-6 p-2">
		<div class="chart-wrap">
			<i class="fas fa-expand-alt"></i>
			<canvas id="enrollement"></canvas>
		</div>
	</div>
	<div class="col-md-6 p-2">
		<div class="chart-wrap">
			<i class="fas fa-expand-alt"></i>
			<canvas id="students_grade"></canvas>
		</div>
	</div>
	<div class="col-md-6 p-2">
		<div class="card w-100 h-100 p-3">
			<h5>{% trans 'Latest activities' %}</h5>
			<ul class="ps-2 small">
				{% for log in logs %}
				<li>{{ log.message }} <span class="text-muted">- {{ log.created_at }}</span></li>
				{% empty %}
				<li>{% trans 'No recent activity' %}</li>
				{% endfor %}
			</ul>
		</div>
	</div>
</div>
<br>
<div class="bg-white p-3">
	<h5 class="border-bottom pb-2">{% trans 'School Demographics' %}</h5>
	<div class="row">
		<div class="col-md-4">
			<i class="fas fa-expand-alt"></i>
			<canvas id="gender"></canvas>
		</div>
		<div class="col-md-4">
			<i class="fas fa-expand-alt"></i>
			<canvas id="ethnicity"></canvas>
		</div>
		<div class="col-md-4">
			<i class="fas fa-expand-alt"></i>
			<canvas id="language"></canvas>
		</div>
	</div>
</div>

{% endblock content %}

{% block js %}

<script src="{% url 'javascript-catalog' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script src="{% static 'js/dashboard.js' %}"></script>
<script>
	$('.fa-expand-alt').click(function () {
		if ($(this).parent('.chart-wrap').parent('.col-md-6').hasClass('expand')) {
			$('.col-md-6.expand').removeClass('expand');
		}
		else {
			$('.col-md-6.expand')?.removeClass('expand');
			$(this).parent('.chart-wrap').parent('.col-md-6').addClass('expand');
		}
	})
</script>
<script>
	const malesCount = {{ males_count }}
const femalesCount = {{ females_count }}

$(document).ready(function () {

    // Setup
    const labels = [
        gettext('January'),
        gettext('February'),
        gettext('March'),
        gettext('April'),
        gettext('May'),
        gettext('June'),
    ];
    // Professional Palette: Google Blue #1a73e8, Google Gray #5f6368, Light Gray #dadce0
    const data = {
        labels: labels,
        datasets: [{
            label: gettext('Students'),
            backgroundColor: 'rgba(26, 115, 232, 0.1)', // Google Blue very light
            borderColor: '#1a73e8', // Google Blue
            borderWidth: 2,
            pointBackgroundColor: '#1a73e8',
            tension: 0.4,
            data: [0, 10, 5, 2, 20, 30, 45]
        }, {
            label: gettext('Teachers'),
            backgroundColor: 'rgba(95, 99, 104, 0.1)', // Google Gray very light
            borderColor: '#5f6368', // Google Gray
            borderWidth: 2,
            pointBackgroundColor: '#5f6368',
            tension: 0.4,
            data: [20, 0, 15, 4, 6, 4, 60],
        }]
    };

    var traffic = document.getElementById('traffic');
    var chart = new Chart(traffic, {
        type: 'line',
        data: data,
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: gettext('System Usage'),
                    padding: 20,
                    font: { size: 16, weight: 'bold' },
                    color: '#202124'
                },
                legend: {
                    position: 'top',
                    align: 'end',
                    labels: { usePointStyle: true, boxWidth: 8 }
                }
            },
            scales: {
                y: { grid: { borderDash: [2, 4], color: '#f1f3f4' }, beginAtZero: true },
                x: { grid: { display: false } }
            }
        }
    });

    // Setup
    const labelsEnrollment = [
        '2022',
        '2023',
        '2024',
        '2025',
    ];
    const dataEnrollment = {
        labels: labelsEnrollment,
        datasets: [{
            label: gettext('Primary'),
            backgroundColor: '#1a73e8', // Google Blue
            borderRadius: 4,
            data: [100, 120, 150, 180]
        }, {
            label: gettext('JHS'),
            backgroundColor: '#8ab4f8', // Lighter Blue
            borderRadius: 4,
            data: [50, 60, 75, 90],
        }]
    };

    var enrollement = document.getElementById('enrollement');
    var chart = new Chart(enrollement, {
        type: 'bar',
        data: dataEnrollment,
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: gettext('Enrollment per level'),
                    padding: 20,
                    font: { size: 16, weight: 'bold' },
                    color: '#202124'
                },
                legend: { position: 'top', align: 'end', labels: { usePointStyle: true, boxWidth: 8 } }
            },
            scales: {
                y: { grid: { borderDash: [2, 4], color: '#f1f3f4' } },
                x: { grid: { display: false } }
            }
        }
    });

    // Average grade setup
    const labelsGrade = [
        '2017',
        '2018',
        '2019',
        '2020',
        '2022',
    ];
    const dataGrade = {
        labels: labelsGrade,
        datasets: [{
            label: gettext("Primary"),
            backgroundColor: '#1a73e8', // Google Blue
            borderRadius: 4,
            data: [70, 75, 72, 78]
        }, {
            label: gettext("JHS"),
            backgroundColor: '#5f6368', // Google Gray
            borderRadius: 4,
            data: [65, 68, 70, 72],
        }]
    };
    
    var students_grade = document.getElementById('students_grade');
    var chart = new Chart(students_grade, {
        type: 'bar',
        data: dataGrade,
        options: {
            responsive: true,
            plugins: {
                title: {
                    display: true,
                    text: gettext('Average Academic Performance'),
                    padding: 20,
                    font: { size: 16, weight: 'bold' },
                    color: '#202124'
                },
                legend: { position: 'top', align: 'end', labels: { usePointStyle: true, boxWidth: 8 } }
            },
            scales: {
                y: { grid: { borderDash: [2, 4], color: '#f1f3f4' } },
                x: { grid: { display: false } }
            }
        }
    });

    const dataGender = {
        labels: [
            gettext('Boys'),
            gettext('Girls')
        ],
        datasets: [{
            data: [malesCount, femalesCount],
            backgroundColor: [
            '#1a73e8', // Google Blue
            '#fbbc04'  // Google Yellow (Accent) instead of pink
            ],
            borderWidth: 0,
            hoverOffset: 4
        }]
    };

    var gender = document.getElementById('gender');
    var chart = new Chart(gender, {
        type: 'doughnut', // Doughnut looks more modern than pie
        data: dataGender,
        options: {
            responsive: true,
            cutout: '70%',
            plugins: {
                title: {
                    display: true,
                    text: gettext('Students Gender'),
                    padding: 20,
                    font: { size: 16, weight: 'bold' },
                    color: '#202124'
                },
                legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8 } }
            }
        }
    });

    const dataQualification = {
        labels: [
            gettext('Master Degree'),
            gettext('Bachelor Degree'),
            gettext('Diploma/Cert')
        ],
        datasets: [{
            data: [10, 45, 25],
            backgroundColor: [
            '#1a73e8', // Blue
            '#5f6368', // Gray
            '#8ab4f8'  // Light Blue
            ],
            borderWidth: 0,
            hoverOffset: 4
        }]
    };
    var ethnicity = document.getElementById('ethnicity');
    var chart = new Chart(ethnicity, {
        type: 'doughnut',
        data: dataQualification,
        options: {
            responsive: true,
            cutout: '70%',
            plugins: {
                title: {
                    display: true,
                    text: gettext('Teacher Qualifications'),
                    padding: 20,
                    font: { size: 16, weight: 'bold' },
                    color: '#202124'
                },
                legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8 } }
            }
        }
    });

    const dataLevels = {
        labels: [
            gettext('Primary 1-3'),
            gettext('Primary 4-6'),
            gettext('JHS 1-3')
        ],
        datasets: [{
            data: [35, 40, 25],
            backgroundColor: [
            '#1a73e8',
            '#5f6368',
            '#e8eaed' // Very light gray
            ],
            borderWidth: 0,
            hoverOffset: 4
        }]
    };
    var language = document.getElementById('language');
    var chart = new Chart(language, {
        type: 'doughnut',
        data: dataLevels,
        options: {
            responsive: true,
            cutout: '70%',
            plugins: {
                title: {
                    display: true,
                    text: gettext('Population by Class Stage'),
                    padding: 20,
                    font: { size: 16, weight: 'bold' },
                    color: '#202124'
                },
                legend: { position: 'bottom', labels: { usePointStyle: true, boxWidth: 8 } }
            }
        }
    });
})

</script>

{% endblock %}