{% extends 'base.html' %}
{% load i18n %}

{% block title %}{% trans 'Promotion Requests' %}{% endblock %}

{% block content %}

<nav aria-label="breadcrumb">
  <ol class="breadcrumb">
    <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
    <li class="breadcrumb-item"><a href="{% url 'school_settings_promotion' %}">{% trans 'School Settings' %}</a></li>
    <li class="breadcrumb-item active">{% trans 'Promotion Requests' %}</li>
  </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
  <div>
    <h2 class="mb-0 fw-bold"><i class="fas fa-inbox me-2 text-warning"></i>{% trans 'Promotion Requests' %}</h2>
    <p class="text-muted small mb-0">{% trans 'Teacher and admin exception requests for student promotion.' %}</p>
  </div>
  <div class="btn-group">
    <a href="?status=PENDING" class="btn btn-sm {% if status_filter == 'PENDING' %}btn-warning{% else %}btn-outline-secondary{% endif %}">
      <i class="fas fa-clock me-1"></i>{% trans 'Pending' %}
    </a>
    <a href="?status=APPROVED" class="btn btn-sm {% if status_filter == 'APPROVED' %}btn-success{% else %}btn-outline-secondary{% endif %}">
      <i class="fas fa-check me-1"></i>{% trans 'Approved' %}
    </a>
    <a href="?status=REJECTED" class="btn btn-sm {% if status_filter == 'REJECTED' %}btn-danger{% else %}btn-outline-secondary{% endif %}">
      <i class="fas fa-times me-1"></i>{% trans 'Rejected' %}
    </a>
  </div>
</div>

{% include 'snippets/messages.html' %}

{% if requests %}
<div class="card border-0 shadow-sm">
  <div class="table-responsive">
    <table class="table table-hover align-middle mb-0">
      <thead class="table-light">
        <tr>
          <th>{% trans 'Student' %}</th>
          <th>{% trans 'Type' %}</th>
          <th>{% trans 'Term Average' %}</th>
          <th>{% trans 'Reason' %}</th>
          <th>{% trans 'Requested By' %}</th>
          <th>{% trans 'Date' %}</th>
          <th>{% trans 'Status' %}</th>
          <th></th>
        </tr>
      </thead>
      <tbody>
        {% for req in requests %}
        <tr>
          <td>
            <strong>{{ req.student.student.get_full_name }}</strong>
            <small class="text-muted d-block">{{ req.result.level }}</small>
          </td>
          <td>
            {% if req.request_type == 'PROMOTE' %}
              <span class="badge bg-success">↑ {% trans 'Promote' %}</span>
            {% else %}
              <span class="badge bg-warning text-dark">↓ {% trans 'Hold Back' %}</span>
            {% endif %}
          </td>
          <td>
            {% if req.result.term_average %}
              <span class="fw-semibold">{{ req.result.term_average }}%</span>
            {% else %}<span class="text-muted">—</span>{% endif %}
          </td>
          <td><small>{{ req.reason|truncatechars:60 }}</small></td>
          <td><small>{{ req.requested_by.get_full_name }}</small></td>
          <td><small class="text-muted">{{ req.created_at|date:"d M Y" }}</small></td>
          <td>
            {% if req.status == 'PENDING' %}
              <span class="badge bg-warning text-dark">{% trans 'Pending' %}</span>
            {% elif req.status == 'APPROVED' %}
              <span class="badge bg-success">{% trans 'Approved' %}</span>
            {% else %}
              <span class="badge bg-danger">{% trans 'Rejected' %}</span>
            {% endif %}
          </td>
          <td>
            {% if req.status == 'PENDING' %}
            <a href="{% url 'promotion_request_review' req.pk %}" class="btn btn-sm btn-outline-primary">
              {% trans 'Review' %}
            </a>
            {% else %}
            <a href="{% url 'promotion_request_review' req.pk %}" class="btn btn-sm btn-outline-secondary">
              {% trans 'View' %}
            </a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>
{% else %}
<div class="text-center py-5">
  <i class="fas fa-inbox fa-3x text-muted mb-3"></i>
  <p class="text-muted">{% trans 'No promotion requests found.' %}</p>
  <a href="{% url 'school_settings_promotion' %}" class="btn btn-outline-secondary">
    ← {% trans 'Back to Settings' %}
  </a>
</div>
{% endif %}

{% endblock %}
