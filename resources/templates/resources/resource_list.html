{% extends 'base.html' %}
{% load i18n %}
{% load static %}

{% block title %}{{ title }} | {% trans 'Learning Management System' %}{% endblock title %}

{% block content %}

<nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
    <ol class="breadcrumb">
        <li class="breadcrumb-item"><a href="/">{% trans 'Home' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'programs' %}">{% trans 'Programs' %}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'program_detail' course.program.id %}">{{ course.program }}</a></li>
        <li class="breadcrumb-item"><a href="{% url 'course_detail' course.slug %}">{{ course }}</a></li>
        <li class="breadcrumb-item active" aria-current="page">{% trans 'Resources' %}</li>
    </ol>
</nav>

<div class="d-flex justify-content-between align-items-center mb-4">
    <div>
        <h2 class="mb-1">{{ course.title }} - {% trans 'Learning Resources' %}</h2>
        <p class="text-muted mb-0">{{ course.summary }}</p>
    </div>
    {% if can_manage %}
    <div>
        <a class="btn btn-primary me-2" href="{% url 'resources:file_upload' course.slug %}">
            <i class="fas fa-file-upload"></i> {% trans 'Upload File' %}
        </a>
        <a class="btn btn-primary" href="{% url 'resources:video_upload' course.slug %}">
            <i class="fas fa-video"></i> {% trans 'Upload Video' %}
        </a>
    </div>
    {% endif %}
</div>

{% include 'snippets/messages.html' %}

<!-- Videos Section -->
<div class="card mb-4">
    <div class="card-header bg-primary text-white">
        <h5 class="mb-0"><i class="fas fa-play-circle"></i> {% trans 'Video Tutorials' %}</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th width="5%">#</th>
                        <th width="10%">{% trans 'Thumbnail' %}</th>
                        <th width="35%">{% trans 'Title' %}</th>
                        <th width="15%">{% trans 'Uploaded' %}</th>
                        <th width="10%">{% trans 'Views' %}</th>
                        <th width="10%">{% trans 'Actions' %}</th>
                        {% if can_manage %}
                        <th width="15%">{% trans 'Manage' %}</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for video in videos %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            {% if video.thumbnail %}
                            <img src="{{ video.thumbnail.url }}" alt="{{ video.title }}" class="img-thumbnail" style="width: 60px; height: 40px; object-fit: cover;">
                            {% else %}
                            <div class="bg bg-secondary text-white d-flex align-items-center justify-content-center" style="width: 60px; height: 40px;">
                                <i class="fas fa-video"></i>
                            </div>
                            {% endif %}
                        </td>
                        <td>
                            <a href="{% url 'resources:video_detail' course.slug video.slug %}" class="text-decoration-none">
                                <strong>{{ video.title }}</strong>
                            </a>
                            {% if video.description %}
                            <br><small class="text-muted">{{ video.description|truncatewords:15 }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ video.timestamp|date:"M d, Y" }}</small>
                            {% if video.uploaded_by %}
                            <br><small class="text-muted">by {{ video.uploaded_by.get_full_name }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-info">
                                <i class="fas fa-eye"></i> {{ video.views }}
                            </span>
                        </td>
                        <td>
                            <a href="{% url 'resources:video_detail' course.slug video.slug %}" class="btn btn-sm btn-primary">
                                <i class="fas fa-play"></i> {% trans 'Watch' %}
                            </a>
                        </td>
                        {% if can_manage %}
                        <td>
                            <a href="{% url 'resources:video_edit' course.slug video.slug %}" class="btn btn-sm btn-warning" title="{% trans 'Edit' %}">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form method="post" action="{% url 'resources:video_delete' course.slug video.slug %}" class="d-inline" onsubmit="return confirm('{% trans 'Are you sure you want to delete this video?' %}');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-danger" title="{% trans 'Delete' %}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{% if can_manage %}7{% else %}6{% endif %}" class="text-center py-4">
                            <i class="fas fa-video fa-3x text-muted mb-3"></i>
                            <p class="text-muted mb-0">{% trans 'No videos uploaded yet.' %}</p>
                            {% if can_manage %}
                            <a href="{% url 'resources:video_upload' course.slug %}" class="btn btn-primary mt-3">
                                <i class="fas fa-upload"></i> {% trans 'Upload First Video' %}
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<!-- Files Section -->
<div class="card">
    <div class="card-header bg-success text-white">
        <h5 class="mb-0"><i class="fas fa-folder-open"></i> {% trans 'Course Documents' %}</h5>
    </div>
    <div class="card-body p-0">
        <div class="table-responsive">
            <table class="table table-hover mb-0">
                <thead class="table-light">
                    <tr>
                        <th width="5%">#</th>
                        <th width="5%">{% trans 'Type' %}</th>
                        <th width="40%">{% trans 'File Name' %}</th>
                        <th width="15%">{% trans 'Uploaded' %}</th>
                        <th width="10%">{% trans 'Downloads' %}</th>
                        <th width="10%">{% trans 'Actions' %}</th>
                        {% if can_manage %}
                        <th width="15%">{% trans 'Manage' %}</th>
                        {% endif %}
                    </tr>
                </thead>
                <tbody>
                    {% for file in files %}
                    <tr>
                        <td>{{ forloop.counter }}</td>
                        <td>
                            <i class="fas fa-file-{{ file.get_extension_short }} fa-2x text-primary"></i>
                        </td>
                        <td>
                            <strong>{{ file.title }}</strong>
                            {% if file.description %}
                            <br><small class="text-muted">{{ file.description|truncatewords:15 }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <small>{{ file.upload_time|date:"M d, Y" }}</small>
                            {% if file.uploaded_by %}
                            <br><small class="text-muted">by {{ file.uploaded_by.get_full_name }}</small>
                            {% endif %}
                        </td>
                        <td>
                            <span class="badge bg-secondary">
                                <i class="fas fa-download"></i> {{ file.downloads }}
                            </span>
                        </td>
                        <td>
                            <div class="btn-group">
                                <a href="{% url 'resources:file_download' course.slug file.pk %}?view=true" target="_blank" class="btn btn-sm btn-info text-white">
                                    <i class="fas fa-eye"></i> {% trans 'View' %}
                                </a>
                                <a href="{% url 'resources:file_download' course.slug file.pk %}" class="btn btn-sm btn-success">
                                    <i class="fas fa-download"></i> {% trans 'Download' %}
                                </a>
                            </div>
                        </td>
                        {% if can_manage %}
                        <td>
                            <a href="{% url 'resources:file_edit' course.slug file.pk %}" class="btn btn-sm btn-warning" title="{% trans 'Edit' %}">
                                <i class="fas fa-edit"></i>
                            </a>
                            <form method="post" action="{% url 'resources:file_delete' course.slug file.pk %}" class="d-inline" onsubmit="return confirm('{% trans 'Are you sure you want to delete this file?' %}');">
                                {% csrf_token %}
                                <button type="submit" class="btn btn-sm btn-danger" title="{% trans 'Delete' %}">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </form>
                        </td>
                        {% endif %}
                    </tr>
                    {% empty %}
                    <tr>
                        <td colspan="{% if can_manage %}7{% else %}6{% endif %}" class="text-center py-4">
                            <i class="fas fa-folder-open fa-3x text-muted mb-3"></i>
                            <p class="text-muted mb-0">{% trans 'No files uploaded yet.' %}</p>
                            {% if can_manage %}
                            <a href="{% url 'resources:file_upload' course.slug %}" class="btn btn-success mt-3">
                                <i class="fas fa-upload"></i> {% trans 'Upload First File' %}
                            </a>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="mt-4">
    <a href="{% url 'course_detail' course.slug %}" class="btn btn-secondary">
        <i class="fas fa-arrow-left"></i> {% trans 'Back to Course' %}
    </a>
</div>

{% endblock content %}
